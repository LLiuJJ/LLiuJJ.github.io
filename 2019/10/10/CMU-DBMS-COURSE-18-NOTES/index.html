<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>CMU-DBMS-COURSE-18-NOTES (Timestamp Ordering Concurrency Control - Optimistic) | TuringTuring</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">CMU-DBMS-COURSE-18-NOTES (Timestamp Ordering Concurrency Control - Optimistic)</h1><a id="logo" href="/.">TuringTuring</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">CMU-DBMS-COURSE-18-NOTES (Timestamp Ordering Concurrency Control - Optimistic)</h1><div class="post-meta">Oct 10, 2019</div><a class="disqus-comment-count" href="/2019/10/10/CMU-DBMS-COURSE-18-NOTES/#vcomment"><span class="valine-comment-count" data-xid="/2019/10/10/CMU-DBMS-COURSE-18-NOTES/"></span><span> 条评论</span></a><div class="post-content"><p><strong>1 Timestamp Ordering Concurrency Control</strong></p>
<p>Timestamp ordering(T/O) is a optimistic class of concurrency control protocols where the DBMS assumes that transaction conflicts are rare. Instead of requiring transactions to acquire locks before thet are allowed to read/write to a database object, the DBMS instead uses timestamps to determine the serializability order of transactions.</p>
<p>Each transaction T(i) is assigned a unique fixed timestamp that is monotonically(单调的) increasing:</p>
<ul>
<li>Let TS(Ti) be the timestamp allocated to transaction Ti</li>
<li>Different schemes assign timestamps at different times during the transaction</li>
</ul>
<p>If TS(Ti) &lt; TS(Tj), then the DBMS must ensure that the execution schedule is equivalent to a serial schedule where Ti appears before Tj.</p>
<p>Muliple timestamp allocation implementation strategies(策略).</p>
<ul>
<li>System clock</li>
<li>Logical counter</li>
<li>Hybrid</li>
</ul>
<p><strong>2 Basic Timestamp Ordering (BASIC T/O)</strong><br>Every database object X is tagged with timestamp of the last transaction successfully did read/write:</p>
<ul>
<li>W-TS(X): Write timestamp on object X.</li>
<li>R-TS(X): Read timestamp on object X.</li>
</ul>
<p>The DBMS check timestamps for every operation. If transaction tries to access an object “from the future”, then the DBMS aborts that transaction and restart it.</p>
<p>Read Operation:</p>
<ul>
<li>IF TS(Ti) &lt; W-TS(X) this violation timestamp order of Ti with regard to the writer of X. Thus you abort Ti and restart it with same TS.</li>
<li>Else:<ul>
<li>Allow Ti to read X.</li>
<li>Update R-TS(X) to max(R-TS(X), TS(Ti)).</li>
<li>Have to make a local copy of X to ensure repeatable reads for Ti.</li>
<li>Last step may be skipped in lower isolation levels.</li>
</ul>
</li>
</ul>
<p>Write Operation:</p>
<ul>
<li>If TS(Ti) &lt; R-TS(X) or TS(Ti) &lt; W-TS(X), abort and restart Ti.</li>
<li>Else:<ul>
<li>Allow Ti to write X and update W-TS(X) to Ti.</li>
<li>Also have to make a local copy of X to ensure repeatable reads for Ti.</li>
</ul>
</li>
</ul>
<p>Optimization: Thomas Write Rule</p>
<ul>
<li>If TS(Ti) &lt; R-TS(X): Abort and restart Ti</li>
<li>If TS(Ti) &lt; W-TS(X):<ul>
<li>Thomas Write Rule: Ignore the write and allow transaction to continue.</li>
<li>Note that this violates timestamp order of Ti but is okay because no other transaction will read Ti’s write to object X.</li>
</ul>
</li>
<li>Else: Allow Ti to write X and update W-TS(X)</li>
</ul>
<p>The Basic T/O protocol generates a schedule that is conflict serializable if you do not use Thomas Write Rule. It cannot have deadlocks because no transation ever waits. But there is a possibility of starvation for log transactions if short transactions keep causing conflicts.</p>
<p>It also permits schedules that are not recoverable. A schedule is recoverable if transactions commit only after all transactions whose changes they read or commit. Otherwise, the DBMS cannot guarantee that transactions read data that will be restored after recovering from a crash.</p>
<p>Potential(潜在) Issues:</p>
<ul>
<li>High overhead(开销) from copying data to transation’s workspace and from updating timestamp.</li>
<li>Long running transactions can get starved: The likelihood that a transaction will read something from a newer transaction increases.</li>
<li>Suffers from the timestamp allocation bottleneck on highly concurrent systems.</li>
</ul>
</div><div class="tags"><a href="/tags/Timestamp-Ordering-Concurrency-Control/">Timestamp Ordering Concurrency Control</a></div><div class="post-nav"><a class="pre" href="/2019/11/19/CMU-DBMS-COURSE-19-NOTES/">CMU-DBMS-COURSE-19-NOTES (MVCC)</a><a class="next" href="/2019/08/04/CMU-DBMS-COURSE-17-NOTES/">CMU-DBMS-COURSE-17-NOTES (Two Phase Locking - Pessimistic)</a></div><div id="vcomment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' ? true : false;
var verify = 'false' ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'ILqOzWM8jrm21Dhs5Ernxczi-gzGzoHsz',
  appKey:'7sChUpdXujjsSpdpukXYva9P',
  placeholder:'Just so so',
  avatar:'mm',
  guest_info:guest_info,
  pageSize:'10'
})</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://turingturing.cn"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Timestamp-Ordering-Concurrency-Control/" style="font-size: 15px;">Timestamp Ordering Concurrency Control</a> <a href="/tags/Database-Storage-I/" style="font-size: 15px;">Database Storage I</a> <a href="/tags/Hash-Tables-Open-Extendible-Linear-Cuckoo/" style="font-size: 15px;">(Hash Tables (Open, Extendible, Linear, Cuckoo))</a> <a href="/tags/Trees-Indexes-II/" style="font-size: 15px;">(Trees Indexes II)</a> <a href="/tags/Index-Concurrency-Control/" style="font-size: 15px;">(Index Concurrency Control)</a> <a href="/tags/Joins-Nested-Loop-Sort-Merge-Hash/" style="font-size: 15px;">Joins (Nested Loop, Sort-Merge, Hash)</a> <a href="/tags/Query-Optimization/" style="font-size: 15px;">Query Optimization</a> <a href="/tags/Query-Processing-Models-Access-Methods-Expression-Evaluation/" style="font-size: 15px;">Query Processing (Models, Access Methods, Expression Evaluation)</a> <a href="/tags/Sorting-Aggregations/" style="font-size: 15px;">Sorting + Aggregations</a> <a href="/tags/Buffer-Pools/" style="font-size: 15px;">Buffer Pools</a> <a href="/tags/Trees-Indexes-I/" style="font-size: 15px;">(Trees Indexes I)</a> <a href="/tags/Parallel-Execution/" style="font-size: 15px;">Parallel Execution</a> <a href="/tags/Two-Phase-Locking/" style="font-size: 15px;">Two Phase Locking</a> <a href="/tags/Concurrency-control-theory/" style="font-size: 15px;">Concurrency control theory</a> <a href="/tags/6-824视频/" style="font-size: 15px;">6.824视频</a> <a href="/tags/Database-Storage-II/" style="font-size: 15px;">Database Storage II</a> <a href="/tags/分布式系统6-824笔记/" style="font-size: 15px;">分布式系统6.824笔记</a> <a href="/tags/各种开发必要的配置摘记/" style="font-size: 15px;">各种开发必要的配置摘记</a> <a href="/tags/movies/" style="font-size: 15px;">movies</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/11/26/Leveldb源码解读9-版本控制/">Leveldb源码解读9-版本控制</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/26/Leveldb源码解读8-compaction/">Leveldb源码解读8-compaction</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/26/Leveldb源码解读7-布隆过滤器/">Leveldb源码解读7-布隆过滤器</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/26/Leveldb源码解读6-缓存系统/">Leveldb源码解读6-缓存系统</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/26/Leveldb源码解读5-sstable/">Leveldb源码解读5-sstable</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/26/Leveldb源码解读4-内存数据库/">Leveldb源码解读4-内存数据库</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/26/Leveldb源码解读3-日志/">Leveldb源码解读3-日志</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/26/Leveldb源码解读2-读写操作/">Leveldb源码解读2-读写操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/26/Leveldb源码解读1-基本概念/">Leveldb源码解读1-基本概念</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/25/CMU-DBMS-COURSE-21-NOTES/">CMU-DBMS-COURSE-21-NOTES (recovery)</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://draveness.me/" title="draveness.me" target="_blank">draveness.me</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">TuringTuring.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>